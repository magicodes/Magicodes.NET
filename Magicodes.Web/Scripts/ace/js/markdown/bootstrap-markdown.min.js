!function(n){"use strict";var t=function(t,i){this.$ns="bootstrap-markdown";this.$element=n(t);this.$editable={el:null,type:null,attrKeys:[],attrValues:[],content:null};this.$options=n.extend(!0,{},n.fn.markdown.defaults,i,this.$element.data(),this.$element.data("options"));this.$oldContent=null;this.$isPreview=!1;this.$isFullscreen=!1;this.$editor=null;this.$textarea=null;this.$handler=[];this.$callback=[];this.$nextTab=[];this.showEditor()},u,i,r;t.prototype={constructor:t,__alterButtons:function(t,i){var r=this.$handler,u=t=="all",f=this;n.each(r,function(n,r){var e=!0;e=u?!1:r.indexOf(t)<0;e==!1&&i(f.$editor.find('button[data-handler="'+r+'"]'))})},__buildButtons:function(t,i){for(var v=this.$ns,w=this.$handler,b=this.$callback,e,s,o,h,c,f=0;f<t.length;f++)for(s=t[f],e=0;e<s.length;e++){for(h=s[e].data,c=n("<div/>",{"class":"btn-group"}),o=0;o<h.length;o++){var r=h[o],u,l,y=v+"-"+r.name,k=this.__getIcon(r.icon),d=r.btnText?r.btnText:"",p=r.btnClass?r.btnClass:"btn",g=r.tabIndex?r.tabIndex:"-1",a=typeof r.hotkey!="undefined"?r.hotkey:"",nt=typeof jQuery.hotkeys!="undefined"&&a!==""?" ("+a+")":"";u=n("<button><\/button>");u.text(" "+this.__localize(d)).addClass("btn-default btn-sm").addClass(p);p.match(/btn\-(primary|success|info|warning|danger|link)/)&&u.removeClass("btn-default");u.attr({type:"button",title:this.__localize(r.title)+nt,tabindex:g,"data-provider":v,"data-handler":y,"data-hotkey":a});r.toggle==!0&&u.attr("data-toggle","button");l=n("<span/>");l.addClass(k);l.prependTo(u);c.append(u);w.push(y);b.push(r.callback)}i.append(c)}return i},__setListener:function(){var t=typeof this.$textarea.attr("rows")!="undefined",i=this.$textarea.val().split("\n").length>5?this.$textarea.val().split("\n").length:"5",r=t?this.$textarea.attr("rows"):i;this.$textarea.attr("rows",r);this.$options.resize&&this.$textarea.css("resize",this.$options.resize);this.$textarea.on("focus",n.proxy(this.focus,this)).on("keypress",n.proxy(this.keypress,this)).on("keyup",n.proxy(this.keyup,this)).on("change",n.proxy(this.change,this));if(this.eventSupported("keydown"))this.$textarea.on("keydown",n.proxy(this.keydown,this));this.$textarea.data("markdown",this)},__handle:function(t){var r=n(t.currentTarget),u=this.$handler,f=this.$callback,i=r.attr("data-handler"),e=u.indexOf(i),o=f[e];n(t.currentTarget).focus();o(this);this.change(this);i.indexOf("cmdSave")<0&&this.$textarea.focus();t.preventDefault()},__localize:function(t){var i=n.fn.markdown.messages,r=this.$options.language;return typeof i!="undefined"&&typeof i[r]!="undefined"&&typeof i[r][t]!="undefined"?i[r][t]:t},__getIcon:function(n){return typeof n=="object"?n[this.$options.iconlibrary]:n},setFullscreen:function(t){var i=this.$editor,r=this.$textarea;if(t===!0){i.addClass("md-fullscreen-mode");n("body").addClass("md-nooverflow");this.$options.onFullscreen(this)}else i.removeClass("md-fullscreen-mode"),n("body").removeClass("md-nooverflow");this.$isFullscreen=t;r.focus()},showEditor:function(){var c=this,u,w=this.$ns,i=this.$element,d=i.css("height"),g=i.css("width"),o=this.$editable,b=this.$handler,k=this.$callback,t=this.$options,r=n("<div/>",{"class":"md-editor",click:function(){c.focus()}}),e,f,y,p,v,s;if(this.$editor==null){if(e=n("<div/>",{"class":"md-header btn-toolbar"}),f=[],t.buttons.length>0&&(f=f.concat(t.buttons[0])),t.additionalButtons.length>0&&(f=f.concat(t.additionalButtons[0])),t.reorderButtonGroups.length>0&&(f=f.filter(function(n){return t.reorderButtonGroups.indexOf(n.name)>-1}).sort(function(n,i){return t.reorderButtonGroups.indexOf(n.name)<t.reorderButtonGroups.indexOf(i.name)?-1:t.reorderButtonGroups.indexOf(n.name)>t.reorderButtonGroups.indexOf(i.name)?1:0})),f.length>0&&(e=this.__buildButtons([f],e)),t.fullscreen.enable)e.append('<div class="md-controls"><a class="md-control md-control-fullscreen" href="#"><span class="'+this.__getIcon(t.fullscreen.icons.fullscreenOn)+'"><\/span><\/a><\/div>').on("click",".md-control-fullscreen",function(n){n.preventDefault();c.setFullscreen(!0)});r.append(e);i.is("textarea")?(i.before(r),u=i,u.addClass("md-input"),r.append(u)):(y=typeof toMarkdown=="function"?toMarkdown(i.html()):i.html(),p=n.trim(y),u=n("<textarea/>",{"class":"md-input",val:p}),r.append(u),o.el=i,o.type=i.prop("tagName").toLowerCase(),o.content=i.html(),n(i[0].attributes).each(function(){o.attrKeys.push(this.nodeName);o.attrValues.push(this.nodeValue)}),i.replaceWith(r));var h=n("<div/>",{"class":"md-footer"}),l=!1,a="";t.savable&&(l=!0,v="cmdSave",b.push(v),k.push(t.onSave),h.append('<button class="btn btn-success" data-provider="'+w+'" data-handler="'+v+'"><i class="icon icon-white icon-ok"><\/i> '+this.__localize("Save")+"<\/button>"));a=typeof t.footer=="function"?t.footer(this):t.footer;n.trim(a)!==""&&(l=!0,h.append(a));l&&r.append(h);t.width&&t.width!=="inherit"&&(jQuery.isNumeric(t.width)?(r.css("display","table"),u.css("width",t.width+"px")):r.addClass(t.width));t.height&&t.height!=="inherit"&&(jQuery.isNumeric(t.height)?(s=t.height,e&&(s=Math.max(0,s-e.outerHeight())),h&&(s=Math.max(0,s-h.outerHeight())),u.css("height",s+"px")):r.addClass(t.height));this.$editor=r;this.$textarea=u;this.$editable=o;this.$oldContent=this.getContent();this.__setListener();this.$editor.attr("id",(new Date).getTime());this.$editor.on("click",'[data-provider="bootstrap-markdown"]',n.proxy(this.__handle,this));(this.$element.is(":disabled")||this.$element.is("[readonly]"))&&(this.$editor.addClass("md-editor-disabled"),this.disableButtons("all"));this.eventSupported("keydown")&&typeof jQuery.hotkeys=="object"&&e.find('[data-provider="bootstrap-markdown"]').each(function(){var t=n(this),i=t.attr("data-hotkey");i.toLowerCase()!==""&&u.bind("keydown",i,function(){return t.trigger("click"),!1})});t.initialstate==="preview"?this.showPreview():t.initialstate==="fullscreen"&&t.fullscreen.enable&&this.setFullscreen(!0)}else this.$editor.show();if(t.autofocus&&(this.$textarea.focus(),this.$editor.addClass("active")),t.fullscreen.enable&&t.fullscreen!==!1){this.$editor.append('          <div class="md-fullscreen-controls">            <a href="#" class="exit-fullscreen" title="Exit fullscreen"><span class="'+this.__getIcon(t.fullscreen.icons.fullscreenOff)+'"><\/span><\/a>          <\/div>');this.$editor.on("click",".exit-fullscreen",function(n){n.preventDefault();c.setFullscreen(!1)})}this.hideButtons(t.hiddenButtons);this.disableButtons(t.disabledButtons);t.onShow(this);return this},parseContent:function(){var t,i=this.$options.onPreview(this),n;return typeof i=="string"?t=i:(n=this.$textarea.val(),t=typeof markdown=="object"?markdown.toHTML(n):typeof marked=="function"?marked(n):n),t},showPreview:function(){var f=this.$options,i=this.$textarea,r=i.next(),t=n("<div/>",{"class":"md-preview","data-provider":"markdown-preview"}),u;return this.$isPreview=!0,this.disableButtons("all").enableButtons("cmdPreview"),u=this.parseContent(),t.html(u),r&&r.attr("class")=="md-footer"?t.insertBefore(r):i.parent().append(t),t.css({width:i.outerWidth()+"px",height:i.outerHeight()+"px"}),this.$options.resize&&t.css("resize",this.$options.resize),i.hide(),t.data("markdown",this),(this.$element.is(":disabled")||this.$element.is("[readonly]"))&&(this.$editor.addClass("md-editor-disabled"),this.disableButtons("all")),this},hidePreview:function(){this.$isPreview=!1;var n=this.$editor.find('div[data-provider="markdown-preview"]');return n.remove(),this.enableButtons("all"),this.disableButtons(this.$options.disabledButtons),this.$textarea.show(),this.__setListener(),this},isDirty:function(){return this.$oldContent!=this.getContent()},getContent:function(){return this.$textarea.val()},setContent:function(n){return this.$textarea.val(n),this},findSelection:function(n){var u=this.getContent(),t,i,r;return(t=u.indexOf(n),t>=0&&n.length>0)?(i=this.getSelection(),this.setSelection(t,t+n.length),r=this.getSelection(),this.setSelection(i.start,i.end),r):null},getSelection:function(){var n=this.$textarea[0];return("selectionStart"in n&&function(){var t=n.selectionEnd-n.selectionStart;return{start:n.selectionStart,end:n.selectionEnd,length:t,text:n.value.substr(n.selectionStart,t)}}||function(){return null})()},setSelection:function(n,t){var i=this.$textarea[0];return("selectionStart"in i&&function(){i.selectionStart=n;i.selectionEnd=t;return}||function(){return null})()},replaceSelection:function(n){var t=this.$textarea[0];return("selectionStart"in t&&function(){return t.value=t.value.substr(0,t.selectionStart)+n+t.value.substr(t.selectionEnd,t.value.length),t.selectionStart=t.value.length,this}||function(){return t.value+=n,jQuery(t)})()},getNextTab:function(){if(this.$nextTab.length==0)return null;var t,n=this.$nextTab.shift();return typeof n=="function"?t=n():typeof n=="object"&&n.length>0&&(t=n),t},setNextTab:function(n,t){var r,i;typeof n=="string"?(r=this,this.$nextTab.push(function(){return r.findSelection(n)})):typeof n=="number"&&typeof t=="number"&&(i=this.getSelection(),this.setSelection(n,t),this.$nextTab.push(this.getSelection()),this.setSelection(i.start,i.end));return},__parseButtonNameParam:function(n){var t=[];return typeof n=="string"?t.push(n):t=n,t},enableButtons:function(t){var i=this.__parseButtonNameParam(t),r=this;return n.each(i,function(n){r.__alterButtons(i[n],function(n){n.removeAttr("disabled")})}),this},disableButtons:function(t){var i=this.__parseButtonNameParam(t),r=this;return n.each(i,function(n){r.__alterButtons(i[n],function(n){n.attr("disabled","disabled")})}),this},hideButtons:function(t){var i=this.__parseButtonNameParam(t),r=this;return n.each(i,function(n){r.__alterButtons(i[n],function(n){n.addClass("hidden")})}),this},showButtons:function(t){var i=this.__parseButtonNameParam(t),r=this;return n.each(i,function(n){r.__alterButtons(i[n],function(n){n.removeClass("hidden")})}),this},eventSupported:function(n){var t=n in this.$element;return t||(this.$element.setAttribute(n,"return;"),t=typeof this.$element[n]=="function"),t},keyup:function(n){var t=!1,i,u,r;switch(n.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:(i=this.getNextTab(),i!=null)?(u=this,setTimeout(function(){u.setSelection(i.start,i.end)},500),t=!0):(r=this.getSelection(),r.start==r.end&&r.end==this.getContent().length?t=!1:(this.setSelection(this.getContent().length,this.getContent().length),t=!0));break;case 13:t=!1;break;case 27:this.$isFullscreen&&this.setFullscreen(!1);t=!1;break;default:t=!1}t&&(n.stopPropagation(),n.preventDefault());this.$options.onChange(this)},change:function(){this.$options.onChange(this);return this},focus:function(){var t=this.$options,r=t.hideable,i=this.$editor;i.addClass("active");n(document).find(".md-editor").each(function(){if(n(this).attr("id")!=i.attr("id")){var t;(t=n(this).find("textarea").data("markdown"),t==null)&&(t=n(this).find('div[data-provider="markdown-preview"]').data("markdown"));t&&t.blur()}});t.onFocus(this);return this},blur:function(){var u=this.$options,e=u.hideable,i=this.$editor,t=this.$editable;if(i.hasClass("active")||this.$element.parent().length==0){if(i.removeClass("active"),e)if(t.el!=null){var r=n("<"+t.type+"/>"),f=this.getContent(),o=typeof markdown=="object"?markdown.toHTML(f):f;n(t.attrKeys).each(function(n){r.attr(t.attrKeys[n],t.attrValues[n])});r.html(o);i.replaceWith(r)}else i.hide();u.onBlur(this)}return this}};u=n.fn.markdown;n.fn.markdown=function(i){return this.each(function(){var r=n(this),u=r.data("markdown"),f=typeof i=="object"&&i;u||r.data("markdown",u=new t(this,f))})};n.fn.markdown.messages={};n.fn.markdown.defaults={autofocus:!1,hideable:!1,savable:!1,width:"inherit",height:"inherit",resize:"none",iconlibrary:"glyph",language:"en",initialstate:"editor",buttons:[[{name:"groupFont",data:[{name:"cmdBold",hotkey:"Ctrl+B",title:"Bold",icon:{glyph:"glyphicon glyphicon-bold",fa:"fa fa-bold","fa-3":"icon-bold"},callback:function(n){var i,r,t=n.getSelection(),u=n.getContent();i=t.length==0?n.__localize("strong text"):t.text;u.substr(t.start-2,2)=="**"&&u.substr(t.end,2)=="**"?(n.setSelection(t.start-2,t.end+2),n.replaceSelection(i),r=t.start-2):(n.replaceSelection("**"+i+"**"),r=t.start+2);n.setSelection(r,r+i.length)}},{name:"cmdItalic",title:"Italic",hotkey:"Ctrl+I",icon:{glyph:"glyphicon glyphicon-italic",fa:"fa fa-italic","fa-3":"icon-italic"},callback:function(n){var i,r,t=n.getSelection(),u=n.getContent();i=t.length==0?n.__localize("emphasized text"):t.text;u.substr(t.start-1,1)=="_"&&u.substr(t.end,1)=="_"?(n.setSelection(t.start-1,t.end+1),n.replaceSelection(i),r=t.start-1):(n.replaceSelection("_"+i+"_"),r=t.start+1);n.setSelection(r,r+i.length)}},{name:"cmdHeading",title:"Heading",hotkey:"Ctrl+H",icon:{glyph:"glyphicon glyphicon-header",fa:"fa fa-font","fa-3":"icon-font"},callback:function(n){var r,u,t=n.getSelection(),f=n.getContent(),i,e;r=t.length==0?n.__localize("heading text"):t.text+"\n";(i=4,f.substr(t.start-i,i)=="### ")||(i=3,f.substr(t.start-i,i)=="###")?(n.setSelection(t.start-i,t.end),n.replaceSelection(r),u=t.start-i):t.start>0&&(e=f.substr(t.start-1,1),!!e&&e!="\n")?(n.replaceSelection("\n\n### "+r),u=t.start+6):(n.replaceSelection("### "+r),u=t.start+4);n.setSelection(u,u+r.length)}}]},{name:"groupLink",data:[{name:"cmdUrl",title:"URL/Link",hotkey:"Ctrl+L",icon:{glyph:"glyphicon glyphicon-link",fa:"fa fa-link","fa-3":"icon-link"},callback:function(t){var u,i,f=t.getSelection(),o=t.getContent(),r,e;u=f.length==0?t.__localize("enter link description here"):f.text;"bootbox"in window?bootbox.prompt(t.__localize("Insert Hyperlink"),function(r){if(r!=null&&r!=""&&r!="http://"&&r.substr(0,4)=="http"){var e=n("<div>"+r+"<\/div>").text();t.replaceSelection("["+u+"]("+e+")");i=f.start+1;t.setSelection(i,i+u.length)}}):(r=prompt(t.__localize("Insert Hyperlink"),"http://"),r!=null&&r!=""&&r!="http://"&&r.substr(0,4)=="http"&&(e=n("<div>"+r+"<\/div>").text(),t.replaceSelection("["+u+"]("+e+")"),i=f.start+1,t.setSelection(i,i+u.length)))}},{name:"cmdImage",title:"Image",hotkey:"Ctrl+G",icon:{glyph:"glyphicon glyphicon-picture",fa:"fa fa-picture-o","fa-3":"icon-picture"},callback:function(t){var u,i,f=t.getSelection(),o=t.getContent(),r,e;u=f.length==0?t.__localize("enter image description here"):f.text;"bootbox"in window?bootbox.prompt(t.__localize("Insert Image Hyperlink"),function(r){if(r!=null&&r!=""&&r!="http://"&&r.substr(0,4)=="http"){var e=n("<div>"+r+"<\/div>").text();t.replaceSelection("!["+u+"]("+e+' "'+t.__localize("enter image title here")+'")');i=f.start+2;t.setNextTab(t.__localize("enter image title here"));t.setSelection(i,i+u.length)}}):(r=prompt(t.__localize("Insert Image Hyperlink"),"http://"),r!=null&&r!=""&&r!="http://"&&r.substr(0,4)=="http"&&(e=n("<div>"+r+"<\/div>").text(),t.replaceSelection("!["+u+"]("+e+' "'+t.__localize("enter image title here")+'")'),i=f.start+2,t.setNextTab(t.__localize("enter image title here")),t.setSelection(i,i+u.length)))}}]},{name:"groupMisc",data:[{name:"cmdList",hotkey:"Ctrl+U",title:"Unordered List",icon:{glyph:"glyphicon glyphicon-list",fa:"fa fa-list","fa-3":"icon-list-ul"},callback:function(t){var r,f,i=t.getSelection(),e=t.getContent(),u;i.length==0?(r=t.__localize("list text here"),t.replaceSelection("- "+r),f=i.start+2):i.text.indexOf("\n")<0?(r=i.text,t.replaceSelection("- "+r),f=i.start+2):(u=[],u=i.text.split("\n"),r=u[0],n.each(u,function(n,t){u[n]="- "+t}),t.replaceSelection("\n\n"+u.join("\n")),f=i.start+4);t.setSelection(f,f+r.length)}},{name:"cmdListO",hotkey:"Ctrl+O",title:"Ordered List",icon:{glyph:"glyphicon glyphicon-th-list",fa:"fa fa-list-ol","fa-3":"icon-list-ol"},callback:function(t){var r,f,i=t.getSelection(),e=t.getContent(),u;i.length==0?(r=t.__localize("list text here"),t.replaceSelection("1. "+r),f=i.start+3):i.text.indexOf("\n")<0?(r=i.text,t.replaceSelection("1. "+r),f=i.start+3):(u=[],u=i.text.split("\n"),r=u[0],n.each(u,function(n,t){u[n]="1. "+t}),t.replaceSelection("\n\n"+u.join("\n")),f=i.start+5);t.setSelection(f,f+r.length)}},{name:"cmdCode",hotkey:"Ctrl+K",title:"Code",icon:{glyph:"glyphicon glyphicon-asterisk",fa:"fa fa-code","fa-3":"icon-code"},callback:function(n){var i,r,t=n.getSelection(),u=n.getContent();i=t.length==0?n.__localize("code text here"):t.text;u.substr(t.start-1,1)=="`"&&u.substr(t.end,1)=="`"?(n.setSelection(t.start-1,t.end+1),n.replaceSelection(i),r=t.start-1):(n.replaceSelection("`"+i+"`"),r=t.start+1);n.setSelection(r,r+i.length)}},{name:"cmdQuote",hotkey:"Ctrl+Q",title:"Quote",icon:{glyph:"glyphicon glyphicon-comment",fa:"fa fa-quote-left","fa-3":"icon-quote-left"},callback:function(t){var r,f,i=t.getSelection(),e=t.getContent(),u;i.length==0?(r=t.__localize("quote here"),t.replaceSelection("> "+r),f=i.start+2):i.text.indexOf("\n")<0?(r=i.text,t.replaceSelection("> "+r),f=i.start+2):(u=[],u=i.text.split("\n"),r=u[0],n.each(u,function(n,t){u[n]="> "+t}),t.replaceSelection("\n\n"+u.join("\n")),f=i.start+4);t.setSelection(f,f+r.length)}}]},{name:"groupUtil",data:[{name:"cmdPreview",toggle:!0,hotkey:"Ctrl+P",title:"Preview",btnText:"Preview",btnClass:"btn btn-primary btn-sm",icon:{glyph:"glyphicon glyphicon-search",fa:"fa fa-search","fa-3":"icon-search"},callback:function(n){var t=n.$isPreview;t==!1?n.showPreview():n.hidePreview()}}]}]],additionalButtons:[],reorderButtonGroups:[],hiddenButtons:[],disabledButtons:[],footer:"",fullscreen:{enable:!0,icons:{fullscreenOn:{fa:"fa fa-expand",glyph:"glyphicon glyphicon-fullscreen","fa-3":"icon-resize-full"},fullscreenOff:{fa:"fa fa-compress",glyph:"glyphicon glyphicon-fullscreen","fa-3":"icon-resize-small"}}},onShow:function(){},onPreview:function(){},onSave:function(){},onBlur:function(){},onFocus:function(){},onChange:function(){},onFullscreen:function(){}};n.fn.markdown.Constructor=t;n.fn.markdown.noConflict=function(){return n.fn.markdown=u,this};i=function(n){var t=n;if(t.data("markdown")){t.data("markdown").showEditor();return}t.markdown()};r=function(t){var r=!1,i,u=n(t.currentTarget);(t.type=="focusin"||t.type=="click")&&u.length==1&&typeof u[0]=="object"&&(i=u[0].activeElement,n(i).data("markdown")||(typeof n(i).parent().parent().parent().attr("class")=="undefined"||n(i).parent().parent().parent().attr("class").indexOf("md-editor")<0?(typeof n(i).parent().parent().attr("class")=="undefined"||n(i).parent().parent().attr("class").indexOf("md-editor")<0)&&(r=!0):r=!1),r&&n(document).find(".md-editor").each(function(){var r=n(i).parent(),t;n(this).attr("id")!=r.attr("id")&&((t=n(this).find("textarea").data("markdown"),t==null)&&(t=n(this).find('div[data-provider="markdown-preview"]').data("markdown")),t&&t.blur())}),t.stopPropagation())};n(document).on("click.markdown.data-api",'[data-provide="markdown-editable"]',function(t){i(n(this));t.preventDefault()}).on("click",function(n){r(n)}).on("focusin",function(n){r(n)}).ready(function(){n('textarea[data-provide="markdown"]').each(function(){i(n(this))})})}(window.jQuery);
//# sourceMappingURL=bootstrap-markdown.min.js.map
